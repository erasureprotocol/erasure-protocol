---
esp: 1000
title: Proofhash Standard
author: Stephane Gosselin (@thegostep)
protocol version: v1.3.1
created: 2020-03-18
---

# Proofhash Standard

## Abstract

This standard outlines how to encode data for producing erasure data proofs. These proofs provide a standard way to encrypt and timestamp data on the erasure protocol.

## Specification

The proof includes the following fields: 
- `esp_version`: The version of the standard which tracks the protocol version in which it was released.
- `creator`: The ethereum address of the owner of the proof.
- `datahash`: The base58 ipld-sha2-256 multihash of the bufferized data. This hash must indicate to the location of the data on ipfs once revealed.
- `keyhash`: The base58 ipld-sha2-256 multihash of the stringified JSON of nacl symmetric key object. This symmetric key is used to encrypt the data. This symmetric key includes a 32 bytes key and 24 bytes nonce created with cryptographic quality entropy. This hash must indicate the location of the symmetric key on ipfs once revealed.
- `encryptedDatahash`: The base58 ipld-sha2-256 multihash of the bufferized encrypted data. This encrypted data is obtained by encrypting the data with the symmetric key. This hash must indicate the location of the encrypted data on ipfs when proof is created.
- `encryptedRecoveryKeyhash`: The base58 ipld-sha2-256 multihash of the bufferized encrypted symmetric key. This recovery key is generated by the proof creator with asymmetric 32 bytes nacl user public encryption keypair. This hash must indicate the location of the encrypted recovery key on ipfs when proof is created and can be used by the creator to reveal the data.

These fields together represent the proof. This proof must be stringified as a JSON then hashed using ipld-sha2-256 multihash to obtain the proofhash.

*Note on asymmetric encryption:* The encryption of the recovery key uses the first 24 byte of the keyhash as a salt.

```
ipld_sha2_256(JSON.stringify({
  esp_version: <v1.3.1>,
  creator: <0x1234...>,
  datahash: ipld_sha2_256(Buffer(<raw data>))),
  keyhash: ipld_sha2_256(JSON.stringify({
    key: <32 bytes symmetric key>,
    nonce: <24 bytes nonce>,
  })),
  encryptedDatahash: ipld_sha2_256(Buffer(<encrypted data>)),
  encryptedRecoveryKeyhash: ipld_sha2_256(Buffer(<encrypted recover key>)),
}))
```

## Motivation

Having a standard way to encode proof for timestamps allows all clients to easily validate these proofs and use the data it includes.

## Backwards Compatibility

This introduces breaking changes with previous version. Clients can infer compatibility by comparing `esp_version` field.

## Reference Implementation

The reference implementation uses the [tweetnacl javascript library](https://github.com/dchest/tweetnacl-js) for encryption.